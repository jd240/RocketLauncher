@model IEnumerable<UserResponse>


@{
    ViewBag.Title = "User List";

    string currentSortBy = ViewBag.CurrentSortBy as string ?? nameof(UserResponse.UserName);
    SortOrderOption currentSortOrder = ViewBag.CurrentSortOrder is SortOrderOption so ? so : SortOrderOption.ASC;

    string currentSearchBy = ViewBag.CurrentSearchBy;
    string currentSearchString = ViewBag.CurrentSearchString;

    SortOrderOption NextOrder(string column)
    {
        // if you click the same column, toggle; otherwise start ASC
        return currentSortOrder == SortOrderOption.ASC
            ? SortOrderOption.DESC
            : SortOrderOption.ASC;
    }
    string SortIcon(string column)
    {
        if (!string.Equals(currentSortBy, column, StringComparison.OrdinalIgnoreCase))
            return ""; 

        return ViewBag.CurrentSortOrder == SortOrderOption.ASC
            ? "fa-sort-up"
            : "fa-sort-down";
    }
}
<form action ="~/users/index" method="get"> 
<h1> Users </h1>
    <a href="~/users/create">Create User</a>
<div class="box flex">
    <div class="flex-1">
            <select class="form-input" name="searchBy">
                @foreach (var field in (Dictionary<string, string>)ViewBag.SearchFields)
                {
                    <option value="@field.Key" selected="@(field.Key == (string)ViewBag.CurrentSearchBy)">
                        @field.Value
                    </option>
                }
            </select>
    </div>
    <div class="flex-1">
        <input type="search" id="Search" class="form-input" placeholder="Search" name="searchString" value="@ViewBag.CurrentSearchString"/>
    </div>
    <div class="flex-1">
        <button class="button button-blue-back"> Search</button>
        <a href="~/users/index" class="link-hover">Clear All</a>
        
    </div>

</div>
<h1>User List</h1>

<table class="table table-striped table-bordered w-100 mt-3">
        <thead>
            <tr>
                <th>
                        User ID
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.UserName)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.UserName))">
                        Username
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.UserName))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.FirstName)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.FirstName))">
                        First Name
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.FirstName))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.LastName)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.LastName))">
                        Last Name
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.LastName))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.Email)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.Email))">
                        Email
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.Email))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.UserRole)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.UserRole))">
                        Role
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.UserRole))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.emailVerified)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.emailVerified))">
                        Email Verified
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.emailVerified))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.DateOfBirth)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.DateOfBirth))">
                        Date of Birth
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.DateOfBirth))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.Address)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.Address))">
                        Address
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.Address))"></i>
                </th>

                <th>
                    <a asp-controller="User"
                       asp-action="Index"
                       asp-route-searchBy="@currentSearchBy"
                       asp-route-searchString="@currentSearchString"
                       asp-route-sortBy="@nameof(UserResponse.TenantName)"
                       asp-route-sortOrder="@NextOrder(nameof(UserResponse.TenantName))">
                        Tenant Name
                    </a>
                    <i class="fa-solid @SortIcon(nameof(UserResponse.TenantName))"></i>
                </th>
            </tr>
        </thead>
    <tbody>
        @if (Model != null && Model.Any())
        {
            foreach (var user in Model)
            {
                <tr>
                    <td>@user.UserID</td>
                    <td>@user.UserName</td>
                    <td>@user.FirstName</td>
                    <td>@user.LastName</td>
                    <td>@user.Email</td>
                    <td>@user.UserRole</td>
                    <td>@(user.emailVerified == true ? "Yes" : "No")</td>
                    <td>@user.DateOfBirth?.ToString("yyyy-MM-dd")</td>
                    <td>@user.Address</td>
                    <td>@user.TenantName</td>
                    <td>
                            <a asp-controller="User" asp-action="UpdateUser" asp-route-UserID="@user.UserID">Edit</a>
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="10" class="text-center text-muted">
                    No users found.
                </td>
            </tr>
        }
    </tbody>
</table>
</form>